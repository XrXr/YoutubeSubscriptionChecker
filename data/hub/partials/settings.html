<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/.
   - Author: XrXr
-->
<h3 class="heading">Settings</h3>

<div class="modal-body">
    <tabset>
      <tab heading="General">
        <br>
        <form class="form-inline" ng-class="tabs.general.interval_class" role="form">
            <label class="control-label">Check Interval &nbsp;</label>
            <input class="form-control" ng-model="config.interval" ng-change="tabs.general.validate(config.interval)" type="text" placeholder="Time in minutes" style="width: 40%">
            &nbsp;
            <label class="control-label">minutes</label>
        </form>
        <br>
        <form class="form-inline" role="form">
            <label class="control-label">Notification Sound
                <input type="checkbox" ng-model = "config.play_sound" class="setting-check-box">
            </label>
        </form>
        <br>
        <form class="form-inline" role="form">
            <label class="control-label">Open Video in Background Tab
                <input type="checkbox" ng-model="config.in_background" class="setting-check-box">
            </label>
        </form>
        <br>
        <form class="form-inline" role="form">
            <label class="control-label">Enable Animations
                <input type="checkbox" ng-model="config.animations" class="setting-check-box">
            </label>
        </form>
        <br>
        <button type="button" class="btn btn-primary" ng-click="tabs.general.clear_history()">Clear History</button>
      </tab>

      <tab heading="Filters" select="tabs.filter.filter_active = true" deselect="tabs.filter.filter_active = false" class="container-fluid">
        <br>
        <div class="row">
          <div class="col-md-5">
            <select select-index="tabs.filter.current_filter" multiple="true" class="form-control filter-select" size="10">
              <option ng-repeat="f in config.filters" class="ellipses" ng-class="get_filter_class(f)" ng-click="tabs.filter.fill_input_form(f)" ng-value="$index">{{f.channel_title + " | " + f.video_title_pattern}}</option>
            </select>
            <form class="form-inline" role="form">
                <!-- Since the title matcher input box has typeahead-editable=false, the model will be `undefined` when the user has not selected one of the options in the popup. Test cases:
                    channel is empty                  | pattern is empty     : disabled
                    channel is empty                  | pattern is non-empty : disabled
                    channel is non-empty, not in list | pattern is empty     : disabled
                    channel is non-empty, not in list | pattern is non-empty : disabled
                    channel is non-empty, in list     | pattern is empty     : disabled
                    channel is non-empty, in list     | pattern is non-empty : enabled
                yes it's just  andThree :: Bool -> Bool -> Bool -> Bool
                               andThree p1 p2 p3 = p1 && p2 && p3
                The getting undefined is special, this needs testing.
                 -->
                <button type="button" ng-click="tabs.filter.add_filter(tabs.filter.new_filter)" ng-disabled="tabs.filter.new_filter.channel_title === undefined || tabs.filter.new_filter.channel_title.length === 0 || tabs.filter.new_filter.video_title_pattern.length === 0" class="btn btn-success">Add</button>
                <button type="button" ng-click="tabs.filter.remove_filter(tabs.filter.current_filter)" class="btn btn-danger">Remove</button>
                <button type="button" ng-click="tabs.filter.move_up(tabs.filter.current_filter)" class="btn btn-primary">&and;</button>
                <button type="button" ng-click="tabs.filter.move_down(tabs.filter.current_filter)" class="btn btn-primary">&or;</button>
            </form>
          </div>
          <div class="col-md-7">
            <h4>For channel that match...</h4>
            <div>
              <input ng-model="tabs.filter.new_filter.channel_title" class="form-control" type="text" typeahead="name for name in channels.name_list | filter:$viewValue | limitTo:4" typeahead-editable="false" placeholder="cases are ignored">
            </div>
            <h4>only videos with title that match...</h4>
            <div>
              <input ng-model="tabs.filter.new_filter.video_title_pattern" class="form-control filter-input" type="text" placeholder="cases are ignored">
              <div class="checkbox filter-regex-checkbox">
                <label>
                  <input type="checkbox" ng-model="tabs.filter.new_filter.video_title_is_regex"> RegEx
                </label>
              </div>
            </div>
            <h4>should be...</h4>
            <label class="checkbox-inline">
              <input type="radio" ng-model="tabs.filter.include_radio_getter_setter" ng-model-options="{ getterSetter: true }" name="filter_option" value="exclude" checked="true"> Excluded
            </label>
            <label class="checkbox-inline">
              <input type="radio" ng-model="tabs.filter.include_radio_getter_setter" ng-model-options="{ getterSetter: true }" name="filter_option" value="include"> Included
            </label>
          </div>
        </div>
      </tab>

      <tab heading="Import/Export" deselect="tabs.import_export.import_error = false;
                                             tabs.import_export.import_success = false;">
        <div class="row">
          <div class="col-md-6">
            <h4>Export</h4>
            <textarea ng-model="tabs.import_export.config_output" cols="30" rows="10" readonly=true></textarea>
            <br>
            <button class="btn btn-primary inout-button" ng-click="tabs.import_export.export_settings()">Export</button>
          </div>
          <div class="col-md-6">
            <h4>Import</h4>
            <textarea ng-model="config_input" cols="30" rows="10"></textarea>
            <button class="btn btn-primary inout-button" ng-click="tabs.import_export.import_settings(config_input)">Import</button>
          </div>
        </div>
      </tab>
    </tabset>
</div>

<div class="modal-footer" style="margin: 0">
    <!-- general related start -->
    <div class="alert alert-danger setting-warning" ng-if="tabs.general.less_than_5">Check interval cannot be lower than 5 minutes</div>
    <div class="alert alert-danger setting-warning" ng-if="tabs.general.bad_input">Check interval must be a positive number</div>
    <!-- general related end -->
    <!-- filters related start-->
    <div class="alert alert-info setting-warning" ng-if="tabs.filter.filter_active">Excluded videos can be found in history</div>
    <div class="alert alert-danger setting-warning" ng-if="tabs.filter.dup_filter">This filter already exist</div>
    <!-- filters related end-->
    <!-- import related start-->
    <div class="alert alert-danger setting-warning" ng-if="tabs.import_export.import_error">Import failed (malformed data?)</div>
    <div class="alert alert-success setting-warning" ng-if="tabs.import_export.import_success">Import successfully finished</div>
    <!-- import related end-->
    <button class="btn btn-primary" ng-click="save()" ng-disabled="!tabs.general.valid">Save</button>
    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
</div>